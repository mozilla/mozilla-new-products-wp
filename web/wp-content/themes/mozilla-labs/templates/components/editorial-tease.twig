{% set posts = posts %}

{# if there are no selected block posts, set teases = the first 3 posts #}
{% if block.posts is empty %}
  {% set teases = posts|slice(0, 3) %}
{% else %}
  {# Convert ACF post objects to Article objects #}
  {% set teases = block.posts|as_article %}

  {# while teases is less than 3, add more posts from selected as they are not duplicates #}
  {% if teases|length < 3 %}
    {% set teases_ids = [] %}
    {% for tease in teases %}
      {% set teases_ids = teases_ids|merge([tease.id ~ '']) %}
    {% endfor %}

    {% for post in posts %}
      {% if not (post.id ~ '' in teases_ids) %}
        {% set teases = teases|merge([post]) %}
        {% set teases_ids = teases_ids|merge([post.id ~ '']) %}
      {% endif %}
    {% endfor %}
  {% endif %}

  {# finally truncate to 3 #}
  {% set teases = teases|slice(0, 3) %}

{% endif %}

<section class="grid grid-site my-32 md:my-52 first:mt-0 last:mb-0">
<div class="col-span-full">
<div class="col-span-full flex flex-row gap-x-1 justify-center type-caption font-bold mb-10">
    <h2 class="text-white">{{ block.title|default('The Latest') }}</h2>
    <span aria-hidden="true">/</span>
     <a href="/stories" class="hocus:text-white">View All</a></a>
  </div>

  <ul class="flex flex-col gap-y-20 md:grid md:grid-cols-3 md:gap-x-32 lg:gap-x-48 md:gap-y-32">
    {% for article in teases %}
      <li class="flex flex-col gap-y-4">
          {% if article.thumbnail %}
            {% include "components/image-icon-watermark.twig" with {
              image: article.thumbnail,
              icon: product and product.icons.grayscale ? get_image(product.icons.grayscale) : null
            } %}
          {% endif %}

          <div class="flex flex-col gap-y-0">
            {% if article.category %}
              <p class="text-secondary/60 block type-headline-14">{{ article.category }}</p>
            {% endif %}

            <h3 class="type-headline-14 leading-tight">
              <a href="{{ article.link }}">
                {{ article.title }}
              </a>
            </h3>
          </div>

        </li>
    {% endfor %}
  </ul>
</div>

</section>
